{% extends 'base.html' %}
{% load static %}
{% load humanize %}  <!-- Puedes quitar intcomma si ya vienen formateados -->

{% block extra_styles %}
  <link rel="stylesheet" href="{% static 'css/print.css' %}" media="print">
{% endblock %}

{% block content %}
<div class="container">
  <h2 style="color: white;" class="mt-4">Detalle de Cierre de Caja</h2>
  <div class="row">
    <div class="col-md-6 mb-4">
      <div class="card p-4 h-100" style="background-color: transparent;">
        <h4 style="color: white;">Información de la Caja</h4>
        <p><strong>ID de Caja:</strong> {{ caja.id }}</p>
        <p><strong>Cajero:</strong> {{ caja.usuario.username }}</p>
        <p><strong>Fecha de Apertura:</strong> {{ caja.fecha_apertura|date:"d/m/Y H:i" }}</p>
        <p><strong>Fecha de Cierre:</strong>
          {% if caja.fecha_cierre %}
            {{ caja.fecha_cierre|date:"d/m/Y H:i" }}
          {% else %}
            <em>Aún no se ha cerrado</em>
          {% endif %}
        </p>
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <div class="card p-4 h-100" style="background-color: transparent;">
        <h4 style="color: white;">Resumen Financiero</h4>
        <p><strong>Efectivo Inicial:</strong> {{ formatted_efectivo_inicial }}</p>
        <p><strong>Total en Débito:</strong> {{ formatted_total_debito }}</p>
        <p><strong>Total en Crédito:</strong> {{ formatted_total_credito }}</p>
        <p><strong>Total en Efectivo:</strong> {{ formatted_total_efectivo }}</p>
        <p><strong>Vuelto Entregado:</strong> {{ formatted_vuelto_entregado }}</p>
        <p><strong>Efectivo Final en Caja:</strong> {{ formatted_efectivo_final }}</p>
        <p><strong>Total de Ventas:</strong> {{ formatted_total_ventas }}</p>
      </div>
    </div>
  </div>

  <div class="no-print d-flex gap-2 mt-3">
    <button onclick="window.print()" class="btn btn-primary">Imprimir Detalle</button>
    {% if caja.estado == 'cerrada' %}
      <button onclick="history.back()" class="btn btn-secondary">Volver</button>
    {% else %}
      <a href="{% url 'abrir_caja' %}" class="btn btn-secondary">Abrir Nueva Caja</a>
    {% endif %}
  </div>
</div>
{% endblock %}